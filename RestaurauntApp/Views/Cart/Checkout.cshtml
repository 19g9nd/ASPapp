@model RestaurauntApp.DTOS.CheckoutDTO
@{
    ViewData["Title"] = "Checkout";
}

<link href="@Url.Content("~/css/Cart/Checkout/light.css")" rel="stylesheet" type="text/css" />
<body class="main-container">

    <form  class="CheckoutForm" asp-action="Checkout" method="post" id="checkoutForm">
        <h1 class="labelCheckout" style="margin: 0 auto; padding: 10px; text-align: center;">@ViewData["Title"]</h1>
        <div class="form-group">
            <label asp-for="FirstName">First Name:</label>
            <input asp-for="FirstName" type="text" required>
        </div>
        <div class="form-group">
            <label asp-for="LastName">Last Name:</label>
            <input asp-for="LastName" type="text" required>
        </div>
        <div class="form-group">
            <label asp-for="Email">Email:</label>
            <input asp-for="Email" type="email" required>
        </div>
        <div class="form-group">
            <label asp-for="Phone">Phone:</label>
            <input asp-for="Phone" type="tel" required>
        </div>
        <div class="form-group">
            <label asp-for="PickupTime">Pick-up Time:</label>
            <input asp-for="PickupTime" type="datetime-local" id="pickupTime" required
                min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")">
        </div>
        <div class="form-group">
            <label asp-for="CardNumber">Card Number:</label>
            <input type="text" asp-for="CardNumber" id="cardNumber" maxlength="19"
                pattern="[0-9]{4}\s?[0-9]{4}\s?[0-9]{4}\s?[0-9]{4}" title="Please enter a valid credit card number"
                required>
        </div>
        <div class="form-group">
            <label asp-for="CVV">CVV:</label>
            <input type="text" asp-for="CVV" id="cvv" pattern="\d{3}" title="Please enter exactly 3 digits" required>
        </div>
        <div class="form-group">
            <label asp-for="Expiry">Expiry:</label>
            <input type="text" id="expiry" placeholder="MM/YY" required pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$" id="expiry"
                asp-for="Expiry" required>
        </div>

        <div asp-validation-summary="All" class="validator"></div>
        <button type="submit" class="btn_checkout">Place Order</button>
    </form>

</body>
<script type="text/javascript">
    document.getElementById('checkoutForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        if (!event.target.checkValidity()) {
            return;
        }

        // Отправка формы после создания заказа из корзины
        await submitFormAndCreateOrder();
    });

    async function submitFormAndCreateOrder() {
         clearCart();
        // Отправляем форму
        document.getElementById('checkoutForm').submit();
    }

    function clearCart() {
        localStorage.removeItem('cartItems');
    }
    var expiryInput = document.getElementById('expiry');

    // Добавляем обработчик события изменения для элемента ввода даты
    expiryInput.addEventListener('input', function (event) {
        // Получаем введенное значение
        var inputValue = event.target.value;

        // Удаляем все нецифровые символы из введенной строки
        var cleanedInput = inputValue.replace(/\D/g, '');

        // Форматируем введенное значение в MM/YY формат (если оно имеет подходящую длину)
        if (cleanedInput.length >= 3) {
            var formattedInput = cleanedInput.substring(0, 2) + '/' + cleanedInput.substring(2, 4);
            expiryInput.value = formattedInput;
        }
    });

</script>
